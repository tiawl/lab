group:
  commands:
  - if:
      not:
        group:
          commands:
          - container:
              status:
                created:
                - var: project
                  key:
                  - literal: container
                - literal: bounce
      group:
        commands:
        - register:
            into:
              var: bounce_theme
            group:
              commands:
              - call:
                  command: new_instance_theme
                  args: []
        - container:
            create:
              name:
              - var: project
                key:
                - literal: container
              - literal: bounce
              image:
              - var: project
                key:
                - literal: image
              - literal: bounce
              hostname:
              - literal: bounce
              volumes:
              - source:
                  inventory: int_ssh_main_keys
                target:
                  inventory: int_ssh_main_keys_path
        - container:
            resource:
              copy:
                name:
                - var: project
                  key:
                  - literal: container
                - literal: bounce
                src:
                - var: path
                  key:
                  - literal: bounce_ssh_key
                dest:
                - var: path
                  key:
                  - literal: ssh_home
        - container:
            resource:
              copy:
                name:
                - var: project
                  key:
                  - literal: container
                - literal: bounce
                src:
                - var: path
                  key:
                  - literal: bounce_ssh_key
                - literal: .pub
                dest:
                - var: path
                  key:
                  - literal: ssh_home
        - network:
            disconnect:
              network:
              - literal: bridge
              container:
              - var: project
                key:
                - literal: container
              - literal: bounce
        - network:
            connect:
              network:
                inventory: ext_ssh_bridge_network_name
              container:
              - var: project
                key:
                - literal: container
              - literal: bounce
        - network:
            connect:
              network:
                inventory: int_ssh_main_network_name
              container:
              - var: project
                key:
                - literal: container
              - literal: bounce
